@page "/"
@using MySql.Data.MySqlClient
@using MySql.Data
@using GymManagementApplication.Classes
<!--To Do
- View Members
- View Equipment
-->
@if (loggedIn is false)
{
    <div class="content-container" style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden;">
        <h1 style="font-size: 48px; color: #ff0000; text-shadow: 0 0 20px #ff4d4d;">Welcome to GymGo Terminal</h1>
        <div style="margin-top: 20px; display: flex; flex-direction: column; align-items: center;">
            <input type="text" placeholder="Username" style="margin-bottom: 10px; padding: 10px; width: 300px; border: 1px solid #ff0000; border-radius: 5px; background: #121212; color: #fff; font-size: 16px;" @bind="username" />
            <input type="password" placeholder="Password" style="margin-bottom: 20px; padding: 10px; width: 300px; border: 1px solid #ff0000; border-radius: 5px; background: #121212; color: #fff; font-size: 16px;" @bind="password" />
            <button style="background: linear-gradient(135deg, #ff0000, #ff4d4d); color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; transition: all 0.3s ease-in-out; box-shadow: 0 0 10px #ff0000;" @onclick="OnLoginClicked">Login</button>
            @if (!string.IsNullOrEmpty(failureMessage))
            {
                <p style="color: #ff0000; margin-top: 10px;">@failureMessage</p>
            }
        </div>
    </div>
}
else
{
    <button style="background: linear-gradient(135deg, #ff0000, #ff4d4d); color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; transition: all 0.3s ease-in-out; box-shadow: 0 0 10px #ff0000;" @onclick="() => viewMembers=true">View members</button>
    <button style="background: linear-gradient(135deg, #ff0000, #ff4d4d); color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; transition: all 0.3s ease-in-out; box-shadow: 0 0 10px #ff0000;" @onclick="() => viewMembers=false">View equipment</button>
    @if (viewMembers)
    {
        <table class="table table-dark">
            <thead>
                <tr>
                    <th scope="col">membership id</th>
                    <th scope="col">member name</th>
                    <th scope="col">start date</th>
                    <th scope="col">end date</th>
                    <th scope="col">membership fee</th>
                </tr>
            </thead>
            <tbody>
					@foreach (var member in members)
					{
					<tr>
						<td>@member.MembershipID</td>
						<td>@member.MemberName</td>
						<td>@member.StartDate.ToString("yyyy-MM-dd")</td>
						<td>@member.EndDate.ToString("yyyy-MM-dd")</td>
						<td>@member.MembershipFee</td>
					</tr>
					}
            </tbody>
        </table>
    }
    else
    {
        <table class="table table-dark">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">First</th>
                    <th scope="col">Last</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th scope="row">1</th>
                    <td>Mark</td>
                    <td>Otto</td>
                </tr>
            </tbody>
        </table>
    }
}
@code {
    private string username;
    private string password;
    private bool loggedIn = false;
    private string failureMessage;
    private bool viewMembers = true;
    private List<Member> members = new List<Member>();
    private MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder
        {
            Server = "sql3.freesqldatabase.com",
            UserID = "sql3774599",
            Password = "4SbFn7kpp9",
            Database = "sql3774599",
        };
    private void OnLoginClicked()
    {
        MySqlConnection connection = new MySqlConnection(builder.ConnectionString);
        connection.Open();
        string sql = "SELECT * FROM login WHERE username = @username AND password = @password";
        MySqlCommand cmd = new MySqlCommand(sql, connection);
        cmd.Parameters.AddWithValue("@username", username);
        cmd.Parameters.AddWithValue("@password", password);
        MySqlDataReader reader = cmd.ExecuteReader();
        if (reader.HasRows)
        {
            loggedIn = true;
            failureMessage = string.Empty;
        }
        else
        {
            failureMessage = "Invalid username or password.";
        }
        connection.Close();
    }
    protected override void OnInitialized()
    {
        getMembers();
    }
    private void getMembers()
    {
        using (MySqlConnection connection = new MySqlConnection(builder.ConnectionString))
        {
            connection.Open();

            string query = "SELECT membershipid, membername, start, end, membershipfee FROM member";

            using (MySqlCommand command = new MySqlCommand(query, connection))
            {
                using (MySqlDataReader reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        members.Add(new Member(
                                reader.GetInt32(0),
                                reader.GetString(1),
                                reader.GetDateTime(2),
                                reader.GetDateTime(3),
                                reader.GetDouble(4)
                        ));
                    }
                }
            }
        }
    }
}
